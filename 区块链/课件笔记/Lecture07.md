# Lecture 07 网络、匿名、监管

## Part 1 比特币网络

* 区块链的分层结构：（从上到下）业务应用层、合约、共识层、网络层、数据层、硬件层

* **比特币底层的 P2P 网络运行机制**
  * **网络的结构 P2P网络**
    * 结构化网络：能够快速地搜索特定的信息
      * 分布式哈希表（DHT）的应用：分布式的存储和寻址技术 
    * 非结构化的网络（比特币所采用的）
      * 不适用 DHT，也没有维护结构的开销
      * 可能会遭受洪泛攻击
  * **在不靠谱的 P2P 网络上比特币节点的操作**
    * 加入 P2P 网络：首先需要使用预先配置的 IP 地址，和 DNS 来找到一些同伴（Peer）
    * 接入比特币网络：节点首先连接上默认为8个的其他节点，在此之上可以继续接收，平均每个接收传入连接的节点大约有30个连接。而它连接到的不活跃结点会在 timeout 后从表中删除。
  * **区块链网络上的比特币交易**
    * 交易发起者使用自己地址的私钥签署交易，将交易广播给整个比特币网络
    * 交易是通过区块来确认的：矿工将交易收集到区块中打包，再通过PoW获得记账权向区块链网络广播该区块。
  * **广播过程**
    * 发送者发送交易或者区块，通知与它连接的节点
    * 接收节点：接收、验证、广播该交易或区块
* **比特币 P2P 网络的一致性要求**
  * 传输延时：在这个延时间隔，一些矿工可能会受到别的新区块
  * 解决节点的不一致性：最长链原则

## Part 2 匿名

* **比特币网络的“匿名”特性**

  * 比特币账户的地址：公钥哈希值
  * 匿名的必要性：隐私
  * 区块链 P2P 网络中的隐私问题
    * 交易记录关联身份
    * 第一个广播的节点可以找到发起交易的源 IP 地址
      * 对策：使用假身份，连接尽可能多的节点

  * 现实世界网络中的隐私问题
    * 某些比特币业务（比特币交易或钱包）可以关联到你的身份
  * **交易的无关联性**
    * 同一个用户的不同地址应该不易关联，同一个用户的不同交易应该不易关联，一个交易的交易双方应该不易关联  
  * 匿名性的讨论：
    * 去中心化与匿名性相互制约，去中心化需要追踪交易来防止各种攻击（例如双花攻击）
    * 如何对比特币的使用匿名化：经常更换自己的首款地址
    * 如何对比特币的使用**去**匿名化：
      * 通过找零钱来推测一个用户的若干个首付款地址
      * 地址簇，交易图谱分析，对交易进行标记成簇
    * 使用混币来让交易图谱分析变得无效（混币中介）
      * 分布式混币：根据用户之间的P2P模式实现混币，不需要一个混币中介
      * 主要方案：合币（Coinjoin）不同用户共同创建一个单一交易
      * 应对高风险交易流：合并规避
        * 帮助存在高风险交易流的用户重获无关联性
        * 允许使用多个 Output 地址进行接收 BTC  

## Part 3 监管

* 政府对比特币的关注
  * 资本管制
  * 查犯罪：例如交易毒品
  * 反洗钱
  * 反串谋
  * 反垄断
* 监管手段
  * 发放加密货币牌照
  * 发布强制政策，限制交易与流通
